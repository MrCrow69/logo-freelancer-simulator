document.addEventListener("DOMContentLoaded", () => {
  const tabs = document.querySelectorAll(".tab-btn");
  const content = document.getElementById("content");
  const notifications = document.getElementById("notifications");

  const adminLoginModal = document.getElementById("admin-login");
  const adminLoginForm = document.getElementById("admin-login-form");
  const adminPasswordInput = document.getElementById("admin-password");
  const adminLoginCancel = document.getElementById("admin-login-cancel");
  const showPasswordCheckbox = document.getElementById("show-password");

  const ADMIN_PASSWORD = "1234"; // Dev password

  let activeTab = "inbox";

  // -- Smooth tab switching --
  function switchTab(newTab) {
    if (newTab === activeTab) return;
    const oldBtn = document.querySelector(`.tab-btn[data-tab="${activeTab}"]`);
    const newBtn = document.querySelector(`.tab-btn[data-tab="${newTab}"]`);

    oldBtn?.classList.remove("active");
    newBtn?.classList.add("active");

    content.style.opacity = 0;
    setTimeout(() => {
      content.innerHTML = `<p>Loading ${newTab} content...</p>`;
      content.style.opacity = 1;
    }, 300);

    activeTab = newTab;
  }

  // Initial load
  switchTab(activeTab);

  tabs.forEach(btn =>
    btn.addEventListener("click", () => switchTab(btn.dataset.tab))
  );

  // -- Notification system --
  function createNotification(message, type = "info", duration = 4000) {
    const notif = document.createElement("div");
    notif.className = `notification notification-${type}`;
    notif.textContent = message;
    notifications.appendChild(notif);

    setTimeout(() => {
      notif.style.opacity = 0;
      setTimeout(() => notif.remove(), 500);
    }, duration);
  }

  // -- Admin panel logic --
  let adminLoggedIn = false;

  function openAdminLogin() {
    adminLoginModal.classList.remove("hidden");
    adminPasswordInput.value = "";
    adminPasswordInput.focus();
  }

  function closeAdminLogin() {
    adminLoginModal.classList.add("hidden");
  }

  adminLoginForm.addEventListener("submit", (e) => {
    e.preventDefault();
    if (adminPasswordInput.value === ADMIN_PASSWORD) {
      adminLoggedIn = true;
      closeAdminLogin();
      createNotification("Admin Access Granted", "info");
    } else {
      createNotification("Incorrect Password", "warning");
      adminPasswordInput.value = "";
    }
  });

  adminLoginCancel.addEventListener("click", closeAdminLogin);

  showPasswordCheckbox.addEventListener("change", () => {
    adminPasswordInput.type = showPasswordCheckbox.checked ? "text" : "password";
  });

  document.addEventListener("keydown", (e) => {
    if (e.ctrlKey && e.shiftKey && e.code === "KeyA") {
      e.preventDefault();
      openAdminLogin();
    }
  });

  // Expose notification system globally if needed
  window.LFS = {
    switchTab,
    createNotification
  };
});
